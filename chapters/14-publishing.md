# アプリ公開と運用

アプリの価値は「作る」だけでは届きません。**配布して、守って、改善する**ところまでが実務です。
この章では、Google Play公開を「事故らずに回す」ための最低限の型をまとめます。

---

## 前提

- `chapters/13-performance.md` を完了し、計測→改善の型がある

## この章でできるようになること

- [ ] Debug/Releaseの違いを説明できる（ログ・最適化・署名）
- [ ] 署名（Keystore / Play App Signing）の考え方を理解する
- [ ] AABを生成して、テストトラックに配布できる
- [ ] R8/Proguardの役割と、トラブル時の切り分けがわかる
- [ ] リリース前チェックリストを自分で回せる
- [ ] リリース後の運用（クラッシュ/指標/ログ）を最低限整えられる

**所要時間の目安：1.5〜2.5時間**

---

## リリースの全体像（実務の流れ）

1. バージョン更新（`versionCode` / `versionName`）
2. Releaseビルドの生成（AAB推奨）
3. テスト（最低限のスモーク + 主要導線）
4. Play Consoleへアップロード（Internal → Closed → Production など）
5. 段階的ロールアウト（可能なら）
6. 公開後の監視（クラッシュ、ANR、レビュー、指標）

---

## 署名と配布（最低限押さえる）

### APKとAAB

- **APK**：端末に直接入れる配布形式（デバッグ/社内配布で見かける）
- **AAB（App Bundle）**：Play配布の推奨形式（端末に最適化されて配信される）

### KeystoreとPlay App Signing

- Keystore（鍵）は**紛失すると詰む**領域なので、管理の方針を最初に決めます
- 個人学習では「作ってみる」がゴールですが、実務では「保管と権限設計」がゴールです

---

## Releaseで壊れやすいポイント

### 1) Debugでは動くのにReleaseで落ちる

よくある原因：

- R8/Proguardでクラス/メソッドが削られた
- リフレクション/シリアライズ周りのkeep rule不足
- Debug専用の依存（Stetho等）に依存していた

対処の型：

1. Releaseビルドで再現するか確認
2. 該当の機能を最小化して原因を絞る
3. keep rule を追加し、影響範囲を確認

### 2) 秘密情報（APIキー等）をコードに埋めた

実務ではやってはいけません。最低限：

- `local.properties` や環境変数から注入する
- リポジトリに鍵をコミットしない
- ダミー値でビルド可能にしておく

---

## リリース前チェックリスト（そのまま使える）

### 機能/品質

- [ ] 主要導線（起動→一覧→詳細→作成/編集→保存）が動く
- [ ] オフライン/失敗時の表示が破綻しない
- [ ] 回転/バックグラウンド復帰でクラッシュしない
- [ ] テストが通っている（最低：ユニットテスト）

### セキュリティ/設定

- [ ] 不要な権限がない
- [ ] ログに個人情報/トークンを出していない
- [ ] APIエンドポイント等が環境で切り替え可能（必要なら）

### ストア

- [ ] アプリアイコン/アプリ名/スクショ/説明文
- [ ] リリースノート（何が変わったか、ユーザー目線）
- [ ] プライバシーポリシー/データ安全性の確認（必要に応じて）

---

## 公開後の運用（実務で差が出る）

公開後に見るべきものは「クラッシュ」だけではありません。

- クラッシュ/ANR（まずはここ）
- ネットワーク失敗率（タイムアウト/5xx/4xxの増加）
- 重要導線の離脱（ログイン、保存、購入など）
- レビューの定性的フィードバック

小さくても良いので「観測できる状態」を作るのが実務力です。

---

## 演習

- リリースノートを“ユーザー目線”で3行で書く
- Releaseビルドを作り、インストールして主要導線を手で確認する
- 「Releaseで壊れそうな点」を3つ挙げ、先回りの対策をメモする

---

## AIに聞いてみよう

### 質問テンプレ（コピペ）

```text
【前提】
この章を学習しています（この章のコンテキストは共有済み）。

【やりたいこと】
（例：Releaseビルドを通したい / 署名やバージョンを整えたい / 公開前チェックをしたい）

【今の状態】
- エラー/ログ：
- いまの設定（gradle/keystore）：
- 期待するゴール：

【欲しい回答】
- 原因候補
- 最短の修正手順
- 公開前チェックリスト（抜け漏れ防止）
```

```text
【質問】
このアプリのリリース前チェックリストを、想定機能（REST/Room/Compose/Hilt）に合わせて拡張して。
優先度順に並べて、理由も添えて。
```

---

## ふりかえり

- Releaseで一番怖い事故は何？どう予防する？
- 「守るべきもの」（秘密情報/ログ/権限）は何？
- リリース前チェックリストを、自分のアプリ用にどう拡張する？

---

## 次の章

次は `chapters/07-unit7-guide.md` に進み、総合演習の進め方（チケット分割）を確認しましょう。
